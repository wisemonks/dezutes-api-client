<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>dezutes.api.php - RDoc Documentation</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "../";
</script>

<script src="../js/jquery.js"></script>
<script src="../js/darkfish.js"></script>

<link href="../css/fonts.css" rel="stylesheet">
<link href="../css/rdoc.css" rel="stylesheet">



<body id="top" role="document" class="file">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../table_of_contents.html#pages">Pages</a>
    <a href="../table_of_contents.html#classes">Classes</a>
    <a href="../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="project-metadata">
    <div id="fileindex-section" class="nav-section">
  <h3>Pages</h3>

  <ul class="link-list">
  
    <li><a href="../README_rdoc.html">README</a>
  
    <li><a href="../php5/dezutes_api_php.html">dezutes.api.php</a>
  
    <li><a href="../php5/dezutes_client_php.html">dezutes.client.php</a>
  
    <li><a href="../php5/en_php.html">en.php</a>
  
    <li><a href="../php5/lt_php.html">lt.php</a>
  
    <li><a href="../php5/ru_php.html">ru.php</a>
  
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-label="Page php5/dezutes.api.php">

<p>&lt;?php #2009-08-14 Arturas</p>

<p>class DezutesAPI {</p>

<pre>private $curl;
private $url = &#39;http://api.dezutes.lt&#39;;
private $url_api_version = &#39;v1&#39;;
private $version = &#39;0.1&#39;;
private $allowed_data_formats = array(&#39;xml&#39;, &#39;json&#39;);
public $data_format = &#39;xml&#39;;
private $api_key;

#$subdomain ir $api_key naudojami autentifikacijai
function __construct($subdomain, $api_key) {
  $this -&gt; api_key = $api_key;
  $this -&gt; curl = curl_init();
  #nurodom autentifikacijos buda
  curl_setopt($this -&gt; curl, CURLOPT_HTTPAUTH, CURLAUTH_BASIC);
  #autentifikacijos duomenys
  curl_setopt($this -&gt; curl, CURLOPT_USERPWD, $subdomain . &quot;:&quot; . $this -&gt; api_key);
  #paprasom, kad su rezultatu grazintu ir headerius. Testavimo sumetimais.
  curl_setopt($this -&gt; curl, CURLOPT_HEADER, false);
  #su uzklausa siunciam ir siokius tokius duomenis apie save. Bendrinei statistikai
  curl_setopt($this -&gt; curl, CURLOPT_USERAGENT, &quot;PHP&quot;.phpversion().&quot;/Dezutes &quot;.$this -&gt; version);
  #paprasom, kad geriau rezultata grazintu, o ne tik ji atspausdintu
  curl_setopt($this -&gt; curl, CURLOPT_RETURNTRANSFER, true);
  curl_setopt($this -&gt; curl, CURLOPT_CONNECTTIMEOUT, 10);
}

#Paprasom, kad rezultatus grazintu pageidaujamu formatu: xml arba json
public function setDataFormat($format = &#39;xml&#39;){
  if(in_array($format, $this -&gt; allowed_data_formats)){
    $this -&gt; data_format = $format;
  }
}

protected function sendRequest($controller, $params = array()){
  curl_setopt($this -&gt; curl, CURLOPT_URL, $this -&gt; constructUrl($controller, $params));
  $result = curl_exec($this -&gt; curl);
  $error = curl_error($this -&gt; curl);
  if(!empty($error)){
    throw new Exception(&quot;Klaida siunciant uzklausa&quot;, curl_error());
  }
  return $result;
}

private function constructUrl($location = &#39;estates&#39;, $params_hash = array()){
  $url_params = array();

  $params_hash[&#39;api_key&#39;] =  $this -&gt; api_key;

  foreach($params_hash as $key =&gt; $value){
    #nepriimam tusciu parametru
    if(empty($value)) continue;

    if(is_array($value)){
      foreach($value as $val){
        $url_params[] = $key.&#39;[]=&#39;.$val;
      }
    }else{
      $url_params[] = $key.&#39;=&#39;.$value;
    }

  }

  $url = $this -&gt; url .&#39;/&#39;. $this -&gt; url_api_version .&#39;/&#39;. $location.&#39;.&#39;.$this -&gt; data_format;

  if(sizeOf($url_params) &gt; 0){
    $url .= &#39;?&#39;.implode(&#39;&amp;&#39;, $url_params);
  }
  return $url;
}

function __destructor(){
  curl_close($this -&gt; curl);
}</pre>

<p>} ?&gt;</p>
</main>



<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="http://docs.seattlerb.org/rdoc/">RDoc</a> 4.2.2.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

